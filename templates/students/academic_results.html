{% extends "base/base.html" %}

{% block title %}Academic Results{% endblock %}

{% block content %}
   
<div class="container mt-4">
    <h2>Academic Results for {{ student.get_full_name }}</h2>
    <p class="lead">Registration Number: {{ student.registration_number }}</p>
    <p>Programme: {{ student.programme.name }}</p>
    
    {% if results_by_year %}
        <div class="accordion" id="resultsAccordion">
            {% for year_name, year_data in results_by_year.items %}
                <div class="card mb-3">
                    <div class="card-header" id="heading{{ forloop.counter }}">
                        <h5 class="mb-0">
                            <button class="btn btn-link" type="button" data-toggle="collapse" 
                                    data-target="#collapse{{ forloop.counter }}" aria-expanded="true" 
                                    aria-controls="collapse{{ forloop.counter }}">
                                {{ year_name }}
                            </button>
                        </h5>
                    </div>
                    
                    <div id="collapse{{ forloop.counter }}" class="collapse {% if forloop.first %}show{% endif %}" 
                         aria-labelledby="heading{{ forloop.counter }}" data-parent="#resultsAccordion">
                        <div class="card-body">
                            {% for semester_number, semester_data in year_data.semesters.items %}
                                <h4>Semester {{ semester_number }}</h4>
                                {% if semester_data.units %}
                                    <div class="table-responsive">
                                        <table class="table table-bordered border-primary">
                                            <thead>
                                                <tr>
                                                    <th>Unit Code</th>
                                                    <th>Unit Name</th>
                                                    <th>CAT</th>
                                                    <th>Exam</th>
                                                    <th>Total Score</th>
                                                    <th>Grade</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for unit in semester_data.units %}
                                                    <tr>
                                                        <td>{{ unit.unit_code }}</td>
                                                        <td>{{ unit.unit_name }}</td>
                                                        
                                                        <!-- Check if CAT score is 0, and show N/A in the cell -->
                                                        <td>
                                                            {% if unit.cat_score == 0 %}
                                                                N/A
                                                            {% else %}
                                                                {{ unit.cat_score }}
                                                            {% endif %}
                                                        </td>
                                                        
                                                        <td>{{ unit.exam_score }}</td>
                                                        <td>{{ unit.total_score }}</td>
                                                        <td>{{ unit.grade }}</td>
                                                        <td>
                                                            {% if  unit.exam_score %}
                                                                {% if unit.is_pass %}
                                                                    <span class="badge text-bg-success">Pass</span>
                                                                {% else %}
                                                                    <span class="badge text-bg-danger">Fail</span>
                                                                {% endif %}
                                                            {% else %}
                                                                <span class="badge text-bg-secondary">N/A</span>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                {% else %}
                                    <div class="alert alert-info">No results available for Semester {{ semester_number }}</div>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="alert alert-warning">
            No academic results available. If you believe this is an error, please contact the academic office.
        </div>
    {% endif %}
</div>
{% endblock %}
